# =============================================================================
# Hodei Jobs Platform - Development Configuration (minikube + DevSpace)
# =============================================================================
# Optimized for fast development cycle:
# - Binary sync (no docker rebuild)
# - Cargo cache persistence
# - Disabled probes for hot reload
# - Increased CPU/memory for in-cluster compilation

replicaCount: 1

# Disable restricted pod security for development
podSecurityStandard:
  enforce: "privileged"

image:
  repository: 10.43.54.80:5000/hodei-jobs-server
  tag: "dev"
  pullPolicy: Always

workerImage:
  repository: 10.43.54.80:5000/hodei-jobs-worker
  tag: "dev"
  pullPolicy: Never

autoscaling:
  enabled: false

podDisruptionBudget:
  enabled: false

# Disable probes for hot reload
livenessProbe: null
readinessProbe: null
startupProbe: null

# Resources for development (HIGH PERFORMANCE)
resources:
  limits:
    cpu: "3"
    memory: "12Gi"
  requests:
    cpu: "2"
    memory: "8Gi"

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0
  fsGroup: 0

securityContext:
  runAsUser: 0
  runAsGroup: 0
  allowPrivilegeEscalation: true
  privileged: false
  readOnlyRootFilesystem: false

# Image pull secrets for local registry
imagePullSecrets:
  - name: docker-registry-secret

# Volume configuration with proper structure for templates
volumes:
  logs:
    enabled: true
    persistent: true
    storageClass: ""
    size: "5Gi"
  tmp:
    enabled: true
    sizeLimit: "1Gi"
  cache:
    enabled: true
    sizeLimit: "1Gi"
  extra:
    - name: cargo-cache
      persistentVolumeClaim:
        claimName: hodei-cargo-cache

volumeMounts:
  - name: cargo-cache
    mountPath: /root/.cargo/registry

# Environment
env:
  RUST_LOG: "debug,hodei=info"
  HODEI_K8S_ENABLED: "1"
  HODEI_DOCKER_ENABLED: "0"
  HODEI_JOB_CONTROLLER_INTERVAL_MS: "200"
  HODEI_RECONCILIATION_ENABLED: "0"

# NATS
nats:
  enabled: true
  replicaCount: 1
  image:
    registry: docker.io
    repository: library/nats
    tag: 2.10-alpine
  persistence:
    enabled: true
    storageClass: local-path
    size: 512Mi
  jetstream:
    enabled: true
  auth:
    enabled: false
  tls:
    enabled: false
  pdb:
    enabled: false
  networkPolicy:
    enabled: false

# PostgreSQL
postgresql:
  enabled: true
  auth:
    postgresPassword: "postgres"
    database: "hodei_jobs"
    username: "postgres"
    password: "postgres"
  persistence:
    enabled: false # Disable PVC for development (use emptyDir)
  primary:
    persistence:
      enabled: false
  pdb:
    enabled: false

externalSecrets:
  enabled: false

backup:
  enabled: false

networkPolicy:
  enabled: false

serviceAccount:
  create: true
  annotations: {}

kubernetesProvider:
  enabled: true
  namespace: hodei-jobs-workers

dockerProvider:
  enabled: false

operator:
  enabled: false

web:
  enabled: false

gateway:
  enabled: true
  type: "nginx"
  host: "hodei.local"
  tls:
    enabled: true
    secretName: "hodei-tls-secret"
  nginx:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"

ingress:
  enabled: false

development:
  enabled: true
  devspace:
    enabled: false # Set to true when using DevSpace for hot-reload development
  cargoCache:
    enabled: true
    pvcName: hodei-cargo-cache
    storageClass: local-path
  binarySync:
    enabled: true
    sourcePath: target/release/hodei-server-bin
    targetPath: /tmp/server-bin
