# =============================================================================
# Hodei Jobs Platform - Development Configuration (minikube)
# =============================================================================
# This file is optimized for local development with minikube

# =============================================================================
# Global Settings
# =============================================================================
global:
  security:
    allowInsecureImages: true

# =============================================================================
# Server Configuration
# =============================================================================
replicaCount: 1

image:
  repository: localhost:5000/hodei-jobs-server
  pullPolicy: Never
  tag: "latest"

# Worker image configuration (separate from server image)
workerImage:
  repository: localhost:5000/hodei-jobs-worker
  pullPolicy: Never
  tag: "latest"

# Disable autoscaling for local development
autoscaling:
  enabled: false

# Disable PDB for local development
podDisruptionBudget:
  enabled: false

# Disable startup probe (server doesn't have /health/startup endpoint)
startupProbe: null
livenessProbe: null
readinessProbe: null

# =============================================================================
# NATS Configuration (using simplified settings)
# =============================================================================
nats:
  enabled: true
  replicaCount: 1
  image:
    registry: docker.io
    repository: library/nats
    tag: 2.10-alpine
  persistence:
    enabled: true
    storageClass: standard
    size: 512Mi
  jetstream:
    enabled: true
  auth:
    enabled: false
  tls:
    enabled: false
  pdb:
    enabled: false

# =============================================================================
# PostgreSQL Configuration
# =============================================================================
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: library/postgres
    tag: 16-alpine
  auth:
    postgresPassword: "postgres"
    database: "hodei_jobs"
    username: "postgres"
    password: "postgres"
  primary:
    persistence:
      enabled: false
  pdb:
    enabled: false

# =============================================================================
# Disable External Secrets for local development
# =============================================================================
externalSecrets:
  enabled: false

# =============================================================================
# Disable backup for local development
# =============================================================================
backup:
  enabled: false

# =============================================================================
# Disable network policies for local development
# =============================================================================
networkPolicy:
  enabled: false

# Disable NATS network policy explicitly
nats:
  networkPolicy:
    enabled: false

# =============================================================================
# Volume Claims & Storage
# =============================================================================
volumes:
  # Temporary storage (ephemeral)
  tmp:
    enabled: true
    sizeLimit: "1Gi"
  # Cache volume (ephemeral)
  cache:
    enabled: true
    sizeLimit: "1Gi"
  # Log storage (persistent - survives pod restarts)
  logs:
    enabled: true
    persistent: true
    storageClass: "standard"
    size: "5Gi"
  # Work volume for job execution
  work:
    enabled: false
    storageClass: ""
    size: "10Gi"
  # Custom volumes
  extra: []

# =============================================================================
# Service Account Configuration
# =============================================================================
serviceAccount:
  create: true
  annotations: {}

# =============================================================================
# Kubernetes Provider Configuration
# =============================================================================
kubernetesProvider:
  enabled: true
  namespace: hodei-jobs-workers

# =============================================================================
# Docker Provider Configuration
# =============================================================================
dockerProvider:
  enabled: false

# =============================================================================
# Disable operator and web for local development
# =============================================================================
operator:
  enabled: false

web:
  enabled: false

# =============================================================================
# Gateway Configuration (Kong API Gateway for local development)
# =============================================================================
gateway:
  enabled: true
  type: "kong"  # Using Kong API Gateway with Minikube
  host: "hodei.local"
  tls:
    enabled: false  # Disable TLS for local development
  kong:
    enabled: true
    adminPort: 8001
    proxyPort: 80
    proxyTLSPort: 443
    plugins:
      rateLimiting:
        enabled: true
        minute: 1000
      requestTransformer:
        enabled: true
    upstream:
      target: "hodei-jobs-platform.hodei-jobs.svc.cluster.local"
      port: 8080
      healthchecks:
        active:
          concurrency: 10
          healthy:
            httpStatuses: [200, 201, 204]
            interval: 5
          unhealthy:
            httpFailures: 5
            interval: 10

# =============================================================================
# Legacy Ingress (disabled - using Kong gateway instead)
# =============================================================================
ingress:
  enabled: false
